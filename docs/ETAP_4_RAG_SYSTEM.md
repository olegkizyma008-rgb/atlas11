# –ï–¢–ê–ü 4: –î–û–°–õ–Ü–î–ñ–ï–ù–ù–Ø RAG –°–ò–°–¢–ï–ú–ò –¢–ê –ë–ê–ó–ò –ó–ù–ê–ù–¨

## üìö –ó–ê–ì–ê–õ–¨–ù–ê –ê–†–•–Ü–¢–ï–ö–¢–£–†–ê RAG

### –©–æ —Ç–∞–∫–µ RAG?
**RAG (Retrieval-Augmented Generation)** - —Ü–µ —Ç–µ—Ö–Ω—ñ–∫–∞, —è–∫–∞ –ø–æ—î–¥–Ω—É—î:
1. **Retrieval** (–ø–æ—à—É–∫) - –∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —É –±–∞–∑—ñ –∑–Ω–∞–Ω—å
2. **Augmentation** (–¥–æ–ø–æ–≤–Ω–µ–Ω–Ω—è) - –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –¥–æ prompt
3. **Generation** (–≥–µ–Ω–µ—Ä–∞—Ü—ñ—è) - –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –∑ —É—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –∫–æ–Ω—Ç–µ–∫—Å—Ç—É

### –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ RAG —Å–∏—Å—Ç–µ–º–∏ –≤ Atlas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  TETYANA EXECUTOR                       ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  –ó–∞–≤–¥–∞–Ω–Ω—è: "–í—ñ–¥–∫—Ä–∏–π Finder"                            ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  RAG Search (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –ü–æ—à—É–∫ —É –±–∞–∑—ñ –∑–Ω–∞–Ω—å                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –ø–æ–¥—ñ–±–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –û—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ               ‚îÇ                                         ‚îÇ
‚îÇ               ‚ñº                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Open Interpreter Bridge                         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –ü–µ—Ä–µ–¥–∞—î prompt –∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º RAG              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –í–∏–∫–æ–Ω—É—î AppleScript                           ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ               ‚îÇ                                         ‚îÇ
‚îÇ               ‚ñº                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  mac_master_agent.py                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –û—Ç—Ä–∏–º—É—î prompt –∑ RAG –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º              ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –ì–µ–Ω–µ—Ä—É—î –∫–æ–¥                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –í–∏–∫–æ–Ω—É—î –¥—ñ—é                                   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ               ‚îÇ                                         ‚îÇ
‚îÇ               ‚ñº                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Grisha Vision Verification                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –ü–µ—Ä–µ–≤—ñ—Ä—è—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç                           ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –ó–±–µ—Ä—ñ–≥–∞—î —É—Å–ø—ñ—à–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              VECTOR DATABASE (Chroma)                   ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Embeddings (BAAI/bge-small-en-v1.5)            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –í–µ–∫—Ç–æ—Ä–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - –°–µ–º–∞–Ω—Ç–∏—á–Ω–∏–π –ø–æ—à—É–∫                            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Knowledge Base                                  ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - macOS automation recipes                      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - AppleScript examples                          ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Best practices                                ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîç INDEX_RAG.PY - –î–ï–¢–ê–õ–¨–ù–ò–ô –ê–ù–ê–õ–Ü–ó

### –§–∞–π–ª: `/Users/dev/mac_assistant/index_rag.py`

#### –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
```python
from langchain_community.document_loaders import DirectoryLoader
from langchain_text_splitters import RecursiveCharacterTextSplitter
from langchain_huggingface import HuggingFaceEmbeddings
from langchain_chroma import Chroma
```

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**
- **DirectoryLoader**: –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑ –ø–∞–ø–∫–∏
- **RecursiveCharacterTextSplitter**: –†–æ–∑–±–∏–≤–∞—î —Ç–µ–∫—Å—Ç –Ω–∞ chunks
- **HuggingFaceEmbeddings**: –ì–µ–Ω–µ—Ä—É—î –≤–µ–∫—Ç–æ—Ä–∏ –¥–ª—è —Ç–µ–∫—Å—Ç—ñ–≤
- **Chroma**: –í–µ–∫—Ç–æ—Ä–Ω–∞ –±–∞–∑–∞ –¥–∞–Ω–∏—Ö

#### –®–ª—è—Ö–∏
```python
KB_PATH = os.path.expanduser("~/mac_assistant_rag/macOS-automation-knowledge-base")
DB_PATH = os.path.expanduser("~/mac_assistant_rag/chroma_mac")
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
~/mac_assistant_rag/
‚îú‚îÄ‚îÄ macOS-automation-knowledge-base/  # –í–∏—Ö—ñ–¥–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ basics.md                     # –ü–æ—Ç–æ—á–Ω–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω—å (–º–∞–ª–∞)
‚îî‚îÄ‚îÄ chroma_mac/                       # –í–µ–∫—Ç–æ—Ä–Ω–∞ –±–∞–∑–∞ (–ø—ñ—Å–ª—è —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó)
    ‚îú‚îÄ‚îÄ data.parquet
    ‚îú‚îÄ‚îÄ index/
    ‚îî‚îÄ‚îÄ metadata.parquet
```

#### –ü—Ä–æ—Ü–µ—Å —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó

##### 1. –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
```python
loader = DirectoryLoader(KB_PATH, glob="**/*.md")
docs = loader.load()
```

**–õ–æ–≥—ñ–∫–∞:**
- –†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —à—É–∫–∞—î –≤—Å—ñ `.md` —Ñ–∞–π–ª–∏
- –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤–º—ñ—Å—Ç –∫–æ–∂–Ω–æ–≥–æ —Ñ–∞–π–ª—É
- –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ Document –æ–±'—î–∫—Ç—ñ–≤

**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:**
- –ó–Ω–∞–π–¥–µ–Ω–æ: 1 —Ñ–∞–π–ª (`basics.md`)
- –†–æ–∑–º—ñ—Ä: 236 –±–∞–π—Ç (–¥—É–∂–µ –º–∞–ª–∞ –±–∞–∑–∞)

##### 2. –†–æ–∑–±–∏—Ç—Ç—è –Ω–∞ chunks
```python
splitter = RecursiveCharacterTextSplitter(
    chunk_size=1000,      # –ú–∞–∫—Å–∏–º—É–º 1000 —Å–∏–º–≤–æ–ª—ñ–≤ –Ω–∞ chunk
    chunk_overlap=200     # –ü–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è 200 —Å–∏–º–≤–æ–ª—ñ–≤
)
texts = splitter.split_documents(docs)
```

**–õ–æ–≥—ñ–∫–∞:**
- –†–æ–∑–±–∏–≤–∞—î –¥–æ–∫—É–º–µ–Ω—Ç–∏ –Ω–∞ –∫—É—Å–∫–∏ —Ä–æ–∑–º—ñ—Ä–æ–º ~1000 —Å–∏–º–≤–æ–ª—ñ–≤
- –ü–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è 200 —Å–∏–º–≤–æ–ª—ñ–≤ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
- –ó–±–µ—Ä—ñ–≥–∞—î –º–µ—Ç–∞—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é (–¥–∂–µ—Ä–µ–ª–æ, –ø–æ–∑–∏—Ü—ñ—è)

**–ü—Ä–∏–∫–ª–∞–¥:**
```
–î–æ–∫—É–º–µ–Ω—Ç: "To open Finder: `open -a Finder`\n\nTo select a file: ..."

Chunk 1: "To open Finder: `open -a Finder`\n\nTo select a file: Use accessibility..."
Chunk 2: "To select a file: Use accessibility API to find the file row..."
```

##### 3. –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è embeddings
```python
embeddings = HuggingFaceEmbeddings(model_name="BAAI/bge-small-en-v1.5")
```

**–ú–æ–¥–µ–ª—å: BAAI/bge-small-en-v1.5**
- **–†–æ–∑–º—ñ—Ä**: small (384-–º—ñ—Ä–Ω—ñ –≤–µ–∫—Ç–æ—Ä–∏)
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: —à–≤–∏–¥–∫–∞
- **–Ø–∫—ñ—Å—Ç—å**: —Ö–æ—Ä–æ—à–∞ –¥–ª—è –∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—ó –º–æ–≤–∏
- **–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É

**–ü—Ä–æ—Ü–µ—Å:**
```
–¢–µ–∫—Å—Ç: "To open Finder: `open -a Finder`"
         ‚Üì
    Embedding Model
         ‚Üì
–í–µ–∫—Ç–æ—Ä: [0.123, -0.456, 0.789, ..., 0.234]  (384 —á–∏—Å–ª–∞)
```

##### 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–µ–∫—Ç–æ—Ä–Ω–æ—ó –±–∞–∑–∏
```python
db = Chroma.from_documents(
    texts,
    embeddings,
    persist_directory=DB_PATH
)
```

**–õ–æ–≥—ñ–∫–∞:**
- –ì–µ–Ω–µ—Ä—É—î embeddings –¥–ª—è –≤—Å—ñ—Ö chunks
- –ó–±–µ—Ä—ñ–≥–∞—î –≤–µ–∫—Ç–æ—Ä–∏ –≤ Chroma DB
- –ó–±–µ—Ä—ñ–≥–∞—î –Ω–∞ –¥–∏—Å–∫—É –¥–ª—è –ø–æ–¥–∞–ª—å—à–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
~/mac_assistant_rag/chroma_mac/
‚îú‚îÄ‚îÄ data.parquet          # –í–µ–∫—Ç–æ—Ä–∏ —Ç–∞ –º–µ—Ç–∞—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
‚îú‚îÄ‚îÄ index/
‚îÇ   ‚îî‚îÄ‚îÄ index.bin         # –Ü–Ω–¥–µ–∫—Å –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –ø–æ—à—É–∫—É
‚îî‚îÄ‚îÄ metadata.parquet      # –ú–µ—Ç–∞—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
```

### –ó–∞–ø—É—Å–∫ —ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó

```bash
python3 ~/mac_assistant/index_rag.py
```

**–í–∏—Ö—ñ–¥:**
```
Loading documents from ~/mac_assistant_rag/macOS-automation-knowledge-base...
Splitting 1 documents...
Initializing embeddings (BAAI/bge-small-en-v1.5)...
Creating/Updating Vector Store...
Successfully indexed X chunks to ~/mac_assistant_rag/chroma_mac
```

## üìñ KNOWLEDGE BASE - –ü–û–¢–û–ß–ù–ò–ô –°–¢–ê–ù

### –§–∞–π–ª: `basics.md`

```markdown
# macOS Automation Knowledge Base

## Finder
To open Finder:
`open -a Finder`

To select a file:
Use accessibility API to find the file row and select it.

## System Settings
To open System Settings:
`open "x-apple.systempreferences:"`
```

**–ê–Ω–∞–ª—ñ–∑:**
- **–†–æ–∑–º—ñ—Ä**: 236 –±–∞–π—Ç (–¥—É–∂–µ –º–∞–ª–∞)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: Markdown –∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- **–í–º—ñ—Å—Ç**: –ë–∞–∑–æ–≤—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –¥–ª—è Finder —Ç–∞ System Settings
- **–ü–æ–∫—Ä–∏—Ç—Ç—è**: –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–µ

### –©–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ –¥–æ Knowledge Base

#### 1. **AppleScript Recipes**
```markdown
## AppleScript Patterns

### Opening Applications
tell application "AppName" to activate

### Typing Text
tell application "System Events" to keystroke "text"

### Keyboard Shortcuts
tell application "System Events" to keystroke "s" using command down
```

#### 2. **Common Tasks**
```markdown
## Common macOS Automation Tasks

### Opening URLs in Safari
tell application "Safari"
    activate
    open location "https://example.com"
end tell

### Clicking UI Elements
tell application "System Events"
    click at {x, y}
end tell
```

#### 3. **Error Handling**
```markdown
## Error Handling

### Permission Errors
If you get "not allowed" error, check System Settings > Privacy & Security > Accessibility

### Timeout Issues
Add delay between actions: delay 0.5
```

#### 4. **Best Practices**
```markdown
## Best Practices

1. Always add delays after actions
2. Activate application before interacting
3. Use accessibility API for UI elements
4. Escape special characters in AppleScript
5. Test scripts in Script Editor first
```

## üîó –Ü–ù–¢–ï–ì–†–ê–¶–Ü–Ø RAG –ó OPEN INTERPRETER

### –Ø–∫ RAG –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è

#### 1. **Search RAG –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è**
```python
# –£ mac_master_agent.py (–≥—ñ–ø–æ—Ç–µ—Ç–∏—á–Ω–æ)
def search_rag(query: str) -> str:
    """–ü–æ—à—É–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ —É –±–∞–∑—ñ –∑–Ω–∞–Ω—å"""
    from langchain_chroma import Chroma
    from langchain_huggingface import HuggingFaceEmbeddings
    
    embeddings = HuggingFaceEmbeddings(model_name="BAAI/bge-small-en-v1.5")
    db = Chroma(
        persist_directory=os.path.expanduser("~/mac_assistant_rag/chroma_mac"),
        embedding_function=embeddings
    )
    
    # –ü–æ—à—É–∫ —Ç–æ–ø-3 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
    results = db.similarity_search(query, k=3)
    
    # –§–æ—Ä–º—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É
    context = "\n".join([doc.page_content for doc in results])
    return context
```

#### 2. **–î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –¥–æ prompt**
```python
# –£ mac_master_agent.py
user_prompt = "–í—ñ–¥–∫—Ä–∏–π Finder"

# –ü–æ—à—É–∫ —É RAG
rag_context = search_rag(user_prompt)

# –†–æ–∑—à–∏—Ä–µ–Ω–∏–π prompt
enhanced_prompt = f"""
You are a macOS automation expert.

KNOWLEDGE BASE:
{rag_context}

USER REQUEST:
{user_prompt}

Provide the AppleScript code to accomplish this task.
"""

# –ü–µ—Ä–µ–¥–∞—á–∞ –¥–æ Open Interpreter
interpreter.chat(enhanced_prompt)
```

#### 3. **–†–µ–∑—É–ª—å—Ç–∞—Ç**
```
User: "–í—ñ–¥–∫—Ä–∏–π Finder"

RAG Search: –ó–Ω–∞—Ö–æ–¥–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç "To open Finder: `open -a Finder`"

Enhanced Prompt:
"""
KNOWLEDGE BASE:
To open Finder:
`open -a Finder`

To select a file:
Use accessibility API to find the file row and select it.

USER REQUEST:
–í—ñ–¥–∫—Ä–∏–π Finder

Provide the AppleScript code...
"""

Open Interpreter –≥–µ–Ω–µ—Ä—É—î:
tell application "Finder" to activate

–†–µ–∑—É–ª—å—Ç–∞—Ç: Finder –≤—ñ–¥–∫—Ä–∏—Ç–∏–π ‚úÖ
```

## üéØ –ö–õ–Æ–ß–û–í–Ü –ö–û–ú–ü–û–ù–ï–ù–¢–ò RAG

### 1. **Vector Database (Chroma)**
- **–¢–∏–ø**: Embedded vector DB
- **–†–æ–∑–º—ñ—Ä**: –õ–µ–≥–∫–∏–π (–ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è)
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –®–≤–∏–¥–∫–∏–π –ø–æ—à—É–∫ O(log n)
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å**: –ó–±–µ—Ä—ñ–≥–∞—î –Ω–∞ –¥–∏—Å–∫—É

### 2. **Embedding Model (BAAI/bge-small-en-v1.5)**
- **–†–æ–∑–º—ñ—Ä –≤–µ–∫—Ç–æ—Ä–∞**: 384 dimensions
- **–ú–æ–≤–∞**: –ê–Ω–≥–ª—ñ–π—Å—å–∫–∞ (–æ—Å–Ω–æ–≤–Ω–∞), –∞–ª–µ –ø—Ä–∞—Ü—é—î –∑ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –®–≤–∏–¥–∫–∞ (CPU-friendly)
- **–Ø–∫—ñ—Å—Ç—å**: –•–æ—Ä–æ—à–∞ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–Ω–æ–≥–æ –ø–æ—à—É–∫—É

### 3. **Text Splitter**
- **–†–æ–∑–º—ñ—Ä chunk**: 1000 —Å–∏–º–≤–æ–ª—ñ–≤
- **–ü–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è**: 200 —Å–∏–º–≤–æ–ª—ñ–≤
- **–ú–µ—Ç–∞**: –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç –º—ñ–∂ chunks

### 4. **Document Loader**
- **–§–æ—Ä–º–∞—Ç**: Markdown (`.md`)
- **–†–µ–∫—É—Ä—Å—ñ—è**: –®—É–∫–∞—î —É –≤—Å—ñ—Ö –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—è—Ö
- **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏

## üìä –ü–û–¢–û–ß–ù–ò–ô –°–¢–ê–ù RAG –°–ò–°–¢–ï–ú–ò

### –ì–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|-----------|--------|---------|
| **Chroma DB** | ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ | –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è |
| **LangChain** | ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ | –ì–æ—Ç–æ–≤–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è |
| **Embeddings** | ‚úÖ –ù–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ | BAAI/bge-small-en-v1.5 |
| **Knowledge Base** | ‚ö†Ô∏è –ú–∞–ª–∞ | –ü–æ—Ç—Ä–µ–±—É—î —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è |
| **Indexing Script** | ‚úÖ –ì–æ—Ç–æ–≤–æ | index_rag.py –≥–æ—Ç–æ–≤–∏–π |
| **RAG Integration** | ‚ö†Ô∏è –ë–∞–∑–æ–≤–∞ | –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó –≤ agent |
| **Self-healing** | ‚ùå –ù–µ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ | –ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó |

### –ü—Ä–æ–±–ª–µ–º–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ú–∞–ª–∞ –±–∞–∑–∞ –∑–Ω–∞–Ω—å
**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:**
- –¢—ñ–ª—å–∫–∏ 1 —Ñ–∞–π–ª (basics.md)
- 236 –±–∞–π—Ç –≤–º—ñ—Å—Ç—É
- –ú–∞–ª–æ –ø—Ä–∏–∫–ª–∞–¥—ñ–≤

**–†—ñ—à–µ–Ω–Ω—è:**
1. –î–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –¥–æ `macOS-automation-knowledge-base/`
2. –í–∫–ª—é—á–∏—Ç–∏ AppleScript recipes
3. –í–∫–ª—é—á–∏—Ç–∏ best practices
4. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `index_rag.py` –¥–ª—è –ø–µ—Ä–µ—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—ó

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –í—ñ–¥—Å—É—Ç–Ω—è —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤ agent
**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:**
- RAG —Å–∏—Å—Ç–µ–º–∞ —ñ—Å–Ω—É—î, –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ mac_master_agent.py
- –ù–µ–º–∞—î —Ñ—É–Ω–∫—Ü—ñ—ó `search_rag()`

**–†—ñ—à–µ–Ω–Ω—è:**
1. –î–æ–¥–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –ø–æ—à—É–∫—É –≤ RAG
2. –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –ø–æ—à—É–∫ —É prompt preparation
3. –¢–µ—Å—Ç—É–≤–∞—Ç–∏ –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω–Ω—è—Ö

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: –í—ñ–¥—Å—É—Ç–Ω—ñ–π self-healing
**–ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω:**
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –≤—á–∏—Ç—å—Å—è –Ω–∞ —É—Å–ø—ñ—à–Ω–∏—Ö –∫—Ä–æ–∫–∞—Ö
- –ù–µ–º–∞—î –º–µ—Ö–∞–Ω—ñ–∑–º—É –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∑–Ω–∞–Ω—å

**–†—ñ—à–µ–Ω–Ω—è:**
1. –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å
2. –î–æ–¥–∞—Ç–∏ –º–µ—Ö–∞–Ω—ñ–∑–º –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –ø–µ—Ä–µ—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ

## üöÄ –ü–õ–ê–ù –†–û–ó–®–ò–†–ï–ù–ù–Ø RAG

### –§–∞–∑–∞ 1: –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è Knowledge Base (–¢–∏–∂–¥–µ–Ω—å 1)
```
–î–æ–¥–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏:
‚îú‚îÄ‚îÄ applescript-recipes.md      (AppleScript –ø—Ä–∏–∫–ª–∞–¥–∏)
‚îú‚îÄ‚îÄ common-tasks.md             (–¢–∏–ø–æ–≤—ñ –∑–∞–≤–¥–∞–Ω–Ω—è)
‚îú‚îÄ‚îÄ error-handling.md           (–û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫)
‚îú‚îÄ‚îÄ best-practices.md           (Best practices)
‚îî‚îÄ‚îÄ ui-automation.md            (UI automation patterns)
```

### –§–∞–∑–∞ 2: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è RAG –≤ Agent (–¢–∏–∂–¥–µ–Ω—å 2)
```python
# –î–æ–¥–∞—Ç–∏ –¥–æ mac_master_agent.py:
- search_rag() —Ñ—É–Ω–∫—Ü—ñ—è
- RAG context —É prompt
- –õ–æ–≥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–∏—Ö –∑–∞–≤–¥–∞–Ω—å
```

### –§–∞–∑–∞ 3: Self-healing (–¢–∏–∂–¥–µ–Ω—å 3)
```python
# –†–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è —É—Å–ø—ñ—à–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤
- –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –¥–æ KB
- –ü–µ—Ä–µ—ñ–Ω–¥–µ–∫—Å–∞—Ü—ñ—è –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö
```

## üìà –ú–ï–¢–†–ò–ö–ò –£–°–ü–Ü–•–£

### –ü–æ—Ç–æ—á–Ω—ñ –º–µ—Ç—Ä–∏–∫–∏
- **–†–æ–∑–º—ñ—Ä KB**: 236 –±–∞–π—Ç
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤**: 1
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å chunks**: 1
- **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è RAG**: 0% (–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è)

### –¶—ñ–ª—å–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ (–ø—ñ—Å–ª—è —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è)
- **–†–æ–∑–º—ñ—Ä KB**: 50+ KB
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤**: 10+
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å chunks**: 50+
- **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è RAG**: 100% (—É –≤—Å—ñ—Ö –∑–∞–≤–¥–∞–Ω–Ω—è—Ö)
- **Hit rate**: 80%+ (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏)

---
**–°—Ç–∞—Ç—É—Å –ï–¢–ê–ü–£ 4**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û
**–ù–∞—Å—Ç—É–ø–Ω–∏–π –µ—Ç–∞–ø**: Vision —Ç–∞ LLM —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è

#!/usr/bin/env bash
# Tetyana v12 — LangGraph Edition Binary Wrapper
# Виконує Python агента з правильними шляхами та змінними оточення

set -e

# Отримати директорію скрипту
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Шляхи
PYTHON_VENV="$PROJECT_ROOT/python/venv/bin/python3"
PYTHON_AGENT="$PROJECT_ROOT/python/mac_master_agent.py"
ENV_FILE="$PROJECT_ROOT/.env"

# Перевірити наявність Python
if [ ! -f "$PYTHON_VENV" ]; then
    echo "❌ Python venv не знайдено: $PYTHON_VENV"
    echo "Будь ласка, переконайтеся, що віртуальне оточення встановлено."
    exit 1
fi

# Перевірити наявність агента
if [ ! -f "$PYTHON_AGENT" ]; then
    echo "❌ Python агент не знайдено: $PYTHON_AGENT"
    exit 1
fi

# Завантажити змінні оточення з .env
if [ -f "$ENV_FILE" ]; then
    export $(grep -v '^#' "$ENV_FILE" | xargs)
fi

# Встановити змінні оточення для Python
export PYTHONUNBUFFERED=1
export PYTHONDONTWRITEBYTECODE=1

# Виконати агента з аргументами
"$PYTHON_VENV" "$PYTHON_AGENT" "$@"
